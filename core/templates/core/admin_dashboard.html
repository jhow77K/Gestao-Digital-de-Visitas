{% extends 'core/base.html' %}
{% block content %}
<div class="admin-dashboard-container">
  <h2>Visitas Recentes</h2>
  <table class="admin-dashboard-table">
    <tr>
      <th>Data</th>
      <th>Período</th>
      <th>Escola</th>
      <th>Responsável</th>
      <th>Nº Crianças</th>
      <th>Nº Adultos</th>
      <th>Forma de Pagamento</th>
      <th>Agência</th>
      <th>Observações</th>
      <th>Status</th>
      <th>Feedback</th>
      <th>Ações</th>
    </tr>
    {% for visita in visitas %}
    <tr>
      <td>{{ visita.data_sugerida|date:"d/m/Y" }}</td>
  <td class="camel-case" data-camel="upper">{{ visita.periodo }}</td>
  <td>{{ visita.escola.nome }}</td>
  <td class="camel-case" data-camel="upper">{{ visita.responsavel }}</td>
  <td>{{ visita.numero_previsto_criancas }}</td>
  <td>{{ visita.numero_previsto_adultos }}</td>
  <td class="camel-case" data-camel="upper">{{ visita.forma_pagamento }}</td>
      <td>{{ visita.agencia }}</td>
      <td>{{ visita.observacoes }}</td>
      <form method="post" action="{% url 'atualizar_status_visita' visita.id %}">
        {% csrf_token %}
        <td class="status-cell">
          <select name="status" aria-label="Status da visita" class="status-badge {% if visita.status == 'SOLICITADO' %}status-solicitado{% elif visita.status == 'CONFIRMADO' %}status-confirmado{% elif visita.status == 'REALIZADO' %}status-realizado{% elif visita.status == 'CANCELADO' %}status-cancelado{% endif %}">
            <option value="SOLICITADO" {% if visita.status == 'SOLICITADO' %}selected{% endif %}>Solicitado</option>
            <option value="CONFIRMADO" {% if visita.status == 'CONFIRMADO' %}selected{% endif %}>Confirmado</option>
            <option value="REALIZADO" {% if visita.status == 'REALIZADO' %}selected{% endif %}>Realizado</option>
            <option value="CANCELADO" {% if visita.status == 'CANCELADO' %}selected{% endif %}>Cancelado</option>
          </select>
        </td>
        <td>
          <textarea name="feedback" rows="2" placeholder="">{{ visita.feedback }}</textarea>
        </td>
        <td>
          <button type="submit">Salvar</button>
        </td>
      </form>
    </tr>
    {% endfor %}
  </table>
</div>
{% endblock %}
